---
layout:     post
title:      åˆ©ç”¨aiå®ç°æç¤ºè¯ç”ŸæˆåŸç†è§£æ
subtitle:   ä»è¿œç¨‹æœåŠ¡å™¨å•¦å–ä»“åº“
date:       2025-02-19
author:     Carlo
header-img: img/post-bg-default.jpg
catalog: true
tags:
  - AI
  - æç¤ºè¯
  - prompt
---
# åˆ©ç”¨aiå®ç°æç¤ºè¯ç”ŸæˆåŸç†è§£æ
## åˆ†ædifyçš„æç¤ºè¯ç”Ÿæˆæºä»£ç 
### æ ¸å¿ƒå‡½æ•°ä»‹ç»
- `PromptTemplateParser` ç±»ä¸»è¦è´Ÿè´£å¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ›¿æ¢ï¼Œæ ¸å¿ƒåŠŸèƒ½å¦‚ä¸‹ï¼š

  1. æ¨¡æ¿å˜é‡è§„åˆ™ ï¼š
      - å˜é‡å¿…é¡»ç”¨ {{}} åŒ…è£¹
      - å˜é‡ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œæœ€å¤§é•¿åº¦30ä¸ªå­—ç¬¦
      - å˜é‡åå¿…é¡»ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´
      - æ”¯æŒä¸‰ç§ç‰¹æ®Šå˜é‡ï¼š {{#histories#}} ã€ {{#query#}} ã€ {{#context#}}
  2. ä¸»è¦æ–¹æ³• ï¼š
      - `extract` ï¼šä»æ¨¡æ¿ä¸­æå–æ‰€æœ‰å˜é‡
      - `format` ï¼šå°†è¾“å…¥çš„å˜é‡å€¼æ›¿æ¢åˆ°æ¨¡æ¿ä¸­
  3. å·¥ä½œæµç¨‹ ï¼š
      ```plaintext
         1. åˆå§‹åŒ–æ—¶ä¼ å…¥æ¨¡æ¿å­—ç¬¦ä¸²
         2. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–æ¨¡æ¿ä¸­çš„æ‰€æœ‰å˜é‡
         3. å½“è°ƒç”¨ format æ–¹æ³•æ—¶ï¼š
            - æ¥æ”¶ä¸€ä¸ªå˜é‡å€¼çš„å­—å…¸
            - éå†æ¨¡æ¿ä¸­çš„å˜é‡
            - ç”¨å­—å…¸ä¸­å¯¹åº”çš„å€¼æ›¿æ¢å˜é‡
            - å¦‚æœå­—å…¸ä¸­æ²¡æœ‰å¯¹åº”çš„å€¼ï¼Œä¿ç•™åŸå§‹å˜é‡
      ```
  4. ä¸¾ä¸ªä¾‹å­ï¼š
      ```python
      template = "Hello {{name}}, welcome to {{place}}!"
      parser = PromptTemplateParser(template)
      result = parser.format({"name": "Alice", "place": "Wonderland"})
      # è¾“å‡º: "Hello Alice, welcome to Wonderland!"
      ```
     
- æç¤ºè¯æ¨¡ç‰ˆè®¾å®š
  1. æ— å˜é‡æ¨¡ç‰ˆä»‹ç» ï¼š
        - WORKFLOW_RULE_CONFIG_PROMPT_GENERATE_TEMPLATE æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„æç¤ºæ¨¡æ¿
        - æ¨¡æ¿è¦æ±‚ AI æ ¹æ®ä»»åŠ¡æè¿°åˆ›å»ºä¸€ä¸ªç»“æ„åŒ–çš„æç¤ºæ¨¡æ¿
        - ç”Ÿæˆçš„æç¤ºæ¨¡æ¿éœ€è¦åŒ…å«æ¸…æ™°çš„æŒ‡ä»¤ã€ç›¸å…³ç¤ºä¾‹ç­‰
        - è¾“å‡ºæ ¼å¼è¦æ±‚ä½¿ç”¨ XML æ ‡ç­¾è¿›è¡Œç»“æ„åŒ–
        - ```python
          WORKFLOW_RULE_CONFIG_PROMPT_GENERATE_TEMPLATE = """
          Here is a task description for which I would like you to create a high-quality prompt template for:
          <task_description>
          {{TASK_DESCRIPTION}}
          </task_description>
          Based on task description, please create a well-structured prompt template that another AI could use to consistently complete the task. The prompt template should include:
          Do not include <input> or <output> section and variables in the prompt, assume user will add them at their own will.
          Clear instructions for the AI that will be using this prompt, demarcated with <instructions> tags. The instructions should provide step-by-step directions on how to complete the task using the input variables. Also Specifies in the instructions that the output should not contain any xml tag.
          Relevant examples if needed to clarify the task further, demarcated with <example> tags. Do not include variables in the prompt. Give three pairs of input and output examples.
          Include other relevant sections demarcated with appropriate XML tags like <examples>, <instructions>.
          Use the same language as task description.
          Output in ``` xml ``` and start with <instruction>
          Please generate the full prompt template with at least 300 words and output only the prompt template.
          """
          ```
        - ```plaintext
            ä¸­æ–‡ç¿»è¯‘ï¼š
            æˆ‘æƒ³è¯·ä½ ä¸ºä»¥ä¸‹ä»»åŠ¡æè¿°åˆ›å»ºä¸€ä¸ªé«˜è´¨é‡çš„æç¤ºæ¨¡æ¿ï¼š
            <task_description>
            {{TASK_DESCRIPTION}}
            </task_description>
            åŸºäºä»»åŠ¡æè¿°ï¼Œè¯·åˆ›å»ºä¸€ä¸ªç»“æ„è‰¯å¥½çš„æç¤ºæ¨¡æ¿ï¼Œä½¿å…¶ä»– AI èƒ½å¤Ÿä¸€è‡´åœ°å®Œæˆä»»åŠ¡ã€‚æç¤ºæ¨¡æ¿åº”åŒ…å«ï¼š
            ç”¨ {{ }} ï¼ˆä¸¤ä¸ªèŠ±æ‹¬å·ï¼‰åŒ…å›´çš„æè¿°æ€§å˜é‡åï¼Œç”¨äºæŒ‡ç¤ºå®é™…å€¼å°†åœ¨ä½•å¤„æ›¿æ¢ã€‚é€‰æ‹©èƒ½æ¸…æ¥šè¡¨æ˜é¢„æœŸå€¼ç±»å‹çš„å˜é‡åã€‚å˜é‡ååªèƒ½ç”±æ•°å­—ã€è‹±æ–‡å­—æ¯å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä¸èƒ½åŒ…å«å…¶ä»–å­—ç¬¦ã€‚
            ç”¨ <instructions> æ ‡ç­¾æ ‡è®°çš„æ¸…æ™°æŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤åº”è¯¥æä¾›ä½¿ç”¨è¾“å…¥å˜é‡å®Œæˆä»»åŠ¡çš„æ­¥éª¤è¯´æ˜ã€‚åŒæ—¶éœ€è¦æŒ‡æ˜è¾“å‡ºä¸åº”åŒ…å«ä»»ä½• xml æ ‡ç­¾ã€‚
            ç”¨ <example> æ ‡ç­¾æ ‡è®°çš„ç›¸å…³ç¤ºä¾‹ï¼ˆå¦‚æœéœ€è¦è¿›ä¸€æ­¥è¯´æ˜ä»»åŠ¡ï¼‰ã€‚é™¤äº† <instruction> éƒ¨åˆ†å¤–ï¼Œä¸è¦åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨èŠ±æ‹¬å·ã€‚
            ç”¨é€‚å½“çš„ XML æ ‡ç­¾ï¼ˆå¦‚ <input>ã€<output> ç­‰ï¼‰æ ‡è®°çš„å…¶ä»–ç›¸å…³éƒ¨åˆ†ã€‚
            ä½¿ç”¨ä¸ä»»åŠ¡æè¿°ç›¸åŒçš„è¯­è¨€ã€‚
            ä»¥ <instruction> å¼€å¤´ï¼Œç”¨ ``` xml ``` æ ¼å¼è¾“å‡ºã€‚
            è¯·ç”Ÿæˆå®Œæ•´çš„æç¤ºæ¨¡æ¿ï¼Œå¹¶ä¸”åªè¾“å‡ºæç¤ºæ¨¡æ¿æœ¬èº«ã€‚
         ```
  2. æœ‰å˜é‡æ¨¡ç‰ˆä»‹ç»
      1. RULE_CONFIG_PROMPT_GENERATE_TEMPLATE ï¼š
          - ç›®çš„ï¼šç”ŸæˆåŒ…å«å˜é‡çš„ç»“æ„åŒ–æç¤ºæ¨¡æ¿
          - ç‰¹ç‚¹ï¼š
            - è¦æ±‚å˜é‡ä½¿ç”¨ {{ }} åŒ…è£¹
            - å˜é‡ååªèƒ½åŒ…å«æ•°å­—ã€è‹±æ–‡å­—æ¯å’Œä¸‹åˆ’çº¿
            - è¾“å‡ºå¿…é¡»æ˜¯ XML æ ¼å¼
            - ä¿æŒä¸ä»»åŠ¡æè¿°ç›¸åŒçš„è¯­è¨€
            - ```python
                # åŒ…å«<instructions> ã€ <example> ã€ <input> ã€ <output>ç­‰æ ‡ç­¾
                  RULE_CONFIG_PROMPT_GENERATE_TEMPLATE = """
                  Here is a task description for which I would like you to create a high-quality prompt template for:
                  <task_description>
                  {{TASK_DESCRIPTION}}
                  </task_description>
                  Based on task description, please create a well-structured prompt template that another AI could use to consistently complete the task. The prompt template should include:
                  - Descriptive variable names surrounded by {{ }} (two curly brackets) to indicate where the actual values will be substituted in. Choose variable names that clearly indicate the type of value expected. Variable names have to be composed of number, english alphabets and underline and nothing else. 
                  - Clear instructions for the AI that will be using this prompt, demarcated with <instructions> tags. The instructions should provide step-by-step directions on how to complete the task using the input variables. Also Specifies in the instructions that the output should not contain any xml tag. 
                  - Relevant examples if needed to clarify the task further, demarcated with <example> tags. Do not use curly brackets any other than in <instruction> section. 
                  - Any other relevant sections demarcated with appropriate XML tags like <input>, <output>, etc.
                  - Use the same language as task description. 
                  - Output in ``` xml ``` and start with <instruction>
                  Please generate the full prompt template and output only the prompt template.
                  """
                ```
            - ```plaintext
                  ä¸­æ–‡ç¿»è¯‘ï¼š
                    æˆ‘æƒ³è¯·ä½ ä¸ºä»¥ä¸‹ä»»åŠ¡æè¿°åˆ›å»ºä¸€ä¸ªé«˜è´¨é‡çš„æç¤ºæ¨¡æ¿ï¼š
                    <task_description>
                    {{TASK_DESCRIPTION}}
                    </task_description>
                    åŸºäºä»»åŠ¡æè¿°ï¼Œè¯·åˆ›å»ºä¸€ä¸ªç»“æ„è‰¯å¥½çš„æç¤ºæ¨¡æ¿ï¼Œä½¿å…¶ä»– AI èƒ½å¤Ÿä¸€è‡´åœ°å®Œæˆä»»åŠ¡ã€‚æç¤ºæ¨¡æ¿åº”åŒ…å«ï¼š
                    ç”¨ {{ }} ï¼ˆä¸¤ä¸ªèŠ±æ‹¬å·ï¼‰åŒ…å›´çš„æè¿°æ€§å˜é‡åï¼Œç”¨äºæŒ‡ç¤ºå®é™…å€¼å°†åœ¨ä½•å¤„æ›¿æ¢ã€‚é€‰æ‹©èƒ½æ¸…æ¥šè¡¨æ˜é¢„æœŸå€¼ç±»å‹çš„å˜é‡åã€‚å˜é‡ååªèƒ½ç”±æ•°å­—ã€è‹±æ–‡å­—æ¯å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä¸èƒ½åŒ…å«å…¶ä»–å­—ç¬¦ã€‚
                    ç”¨ <instructions> æ ‡ç­¾æ ‡è®°çš„æ¸…æ™°æŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤åº”è¯¥æä¾›ä½¿ç”¨è¾“å…¥å˜é‡å®Œæˆä»»åŠ¡çš„æ­¥éª¤è¯´æ˜ã€‚åŒæ—¶éœ€è¦æŒ‡æ˜è¾“å‡ºä¸åº”åŒ…å«ä»»ä½• xml æ ‡ç­¾ã€‚
                    ç”¨ <example> æ ‡ç­¾æ ‡è®°çš„ç›¸å…³ç¤ºä¾‹ï¼ˆå¦‚æœéœ€è¦è¿›ä¸€æ­¥è¯´æ˜ä»»åŠ¡ï¼‰ã€‚é™¤äº† <instruction> éƒ¨åˆ†å¤–ï¼Œä¸è¦åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨èŠ±æ‹¬å·ã€‚
                    ç”¨é€‚å½“çš„ XML æ ‡ç­¾ï¼ˆå¦‚ <input>ã€<output> ç­‰ï¼‰æ ‡è®°çš„å…¶ä»–ç›¸å…³éƒ¨åˆ†ã€‚
                    ä½¿ç”¨ä¸ä»»åŠ¡æè¿°ç›¸åŒçš„è¯­è¨€ã€‚
                    ä»¥ <instruction> å¼€å¤´ï¼Œç”¨ ``` xml ``` æ ¼å¼è¾“å‡ºã€‚
                    è¯·ç”Ÿæˆå®Œæ•´çš„æç¤ºæ¨¡æ¿ï¼Œå¹¶ä¸”åªè¾“å‡ºæç¤ºæ¨¡æ¿æœ¬èº«ã€‚
               ```
        
      2. RULE_CONFIG_PARAMETER_GENERATE_TEMPLATE ï¼š
         - ç›®çš„ï¼šä»è¾“å…¥æ–‡æœ¬ä¸­æå–å˜é‡å
         - å·¥ä½œæµç¨‹ï¼š
             - è¯»å–å¹¶ç†è§£è¾“å…¥æ–‡æœ¬
             - æå–ç›¸å…³å‚æ•°
             - å°†å‚æ•°è½¬æ¢ä¸º JSON æ ¼å¼
             - è¾“å‡ºå˜é‡ååˆ—è¡¨
         - è¾“å‡ºæ ¼å¼ï¼š ["variable_name_1", "variable_name_2"]
         - ç‰¹ç‚¹ï¼šåªè¾“å‡ºå˜é‡ååˆ—è¡¨ï¼Œä¸åŒ…å«å…¶ä»–å†…å®¹
         - ```python
                  RULE_CONFIG_PARAMETER_GENERATE_TEMPLATE = """
                  I need to extract the following information from the input text. The <information to be extracted> tag specifies the 'type', 'description' and 'required' of the information to be extracted. 
                  <information to be extracted>
                  variables name bounded two double curly brackets. Variable name has to be composed of number, english alphabets and underline and nothing else. 
                  </information to be extracted>

                  Step 1: Carefully read the input and understand the structure of the expected output.
                  Step 2: Extract relevant parameters from the provided text based on the name and description of object. 
                  Step 3: Structure the extracted parameters to JSON object as specified in <structure>.
                  Step 4: Ensure that the list of variable_names is properly formatted and valid. The output should not contain any XML tags. Output an empty list if there is no valid variable name in input text. 

                  ### Structure
                  Here is the structure of the expected output, I should always follow the output structure. 
                  ["variable_name_1", "variable_name_2"]

                  ### Input Text
                  Inside <text></text> XML tags, there is a text that I should extract parameters and convert to a JSON object.
                  <text>
                  {{INPUT_TEXT}}
                  </text>

                  ### Answer
                  I should always output a valid list. Output nothing other than the list of variable_name. Output an empty list if there is no variable name in input text.
                  """
           ```
           - ```plaintext
                  ä¸­æ–‡ç¿»è¯‘ï¼š
                    æˆ‘éœ€è¦ä»è¾“å…¥æ–‡æœ¬ä¸­æå–ä»¥ä¸‹ä¿¡æ¯ã€‚<information to be extracted> æ ‡ç­¾æŒ‡å®šäº†éœ€è¦æå–çš„ä¿¡æ¯çš„"ç±»å‹"ã€"æè¿°"å’Œ"æ˜¯å¦å¿…éœ€"ã€‚
                    <information to be extracted>
                    ç”±ä¸¤ä¸ªèŠ±æ‹¬å·åŒ…å›´çš„å˜é‡åã€‚å˜é‡åå¿…é¡»ä»…ç”±æ•°å­—ã€è‹±æ–‡å­—æ¯å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä¸èƒ½åŒ…å«å…¶ä»–å­—ç¬¦ã€‚
                    </information to be extracted>
                    
                    æ­¥éª¤ 1ï¼šä»”ç»†é˜…è¯»è¾“å…¥å¹¶ç†è§£é¢„æœŸè¾“å‡ºçš„ç»“æ„ã€‚
                    æ­¥éª¤ 2ï¼šæ ¹æ®å¯¹è±¡çš„åç§°å’Œæè¿°ä»æä¾›çš„æ–‡æœ¬ä¸­æå–ç›¸å…³å‚æ•°ã€‚
                    æ­¥éª¤ 3ï¼šæŒ‰ç…§ <structure> ä¸­æŒ‡å®šçš„æ ¼å¼å°†æå–çš„å‚æ•°æ„é€ æˆ JSON å¯¹è±¡ã€‚
                    æ­¥éª¤ 4ï¼šç¡®ä¿å˜é‡ååˆ—è¡¨æ ¼å¼æ­£ç¡®ä¸”æœ‰æ•ˆã€‚è¾“å‡ºä¸åº”åŒ…å«ä»»ä½• XML æ ‡ç­¾ã€‚å¦‚æœè¾“å…¥æ–‡æœ¬ä¸­æ²¡æœ‰æœ‰æ•ˆçš„å˜é‡åï¼Œåˆ™è¾“å‡ºç©ºåˆ—è¡¨ã€‚
                    
                    ### ç»“æ„
                    è¿™æ˜¯é¢„æœŸè¾“å‡ºçš„ç»“æ„ï¼Œæˆ‘åº”è¯¥å§‹ç»ˆéµå¾ªè¿™ä¸ªè¾“å‡ºç»“æ„ï¼š
                    ["variable_name_1", "variable_name_2"]
                    
                    ### è¾“å…¥æ–‡æœ¬
                    åœ¨ <text></text> XML æ ‡ç­¾å†…ï¼Œæœ‰ä¸€æ®µéœ€è¦æå–å‚æ•°å¹¶è½¬æ¢ä¸º JSON å¯¹è±¡çš„æ–‡æœ¬ã€‚
                    <text>
                    {{INPUT_TEXT}}
                    </text>
                    
                    ### ç­”æ¡ˆ
                    æˆ‘åº”è¯¥å§‹ç»ˆè¾“å‡ºä¸€ä¸ªæœ‰æ•ˆçš„åˆ—è¡¨ã€‚é™¤äº†å˜é‡ååˆ—è¡¨å¤–ä¸è¦è¾“å‡ºå…¶ä»–å†…å®¹ã€‚å¦‚æœè¾“å…¥æ–‡æœ¬ä¸­æ²¡æœ‰å˜é‡åï¼Œåˆ™è¾“å‡ºç©ºåˆ—è¡¨ã€‚
             ```
      3. RULE_CONFIG_STATEMENT_GENERATE_TEMPLATE ï¼š
         - ç›®çš„ï¼šç”ŸæˆèŠå¤©æœºå™¨äººçš„å¼€åœºç™½
         - å·¥ä½œæµç¨‹ï¼š
             - ä»ä»»åŠ¡æè¿°ä¸­è¯†åˆ«æœºå™¨äººçš„ç›®çš„
             - æ¨æ–­æœºå™¨äººçš„è¯­æ°”ï¼ˆå‹å¥½ã€ä¸“ä¸šç­‰ï¼‰
             - åˆ›å»ºè¿è´¯ä¸”å¸å¼•äººçš„å¼€åœºç™½
         - ç‰¹ç‚¹ï¼š
             - æ ¹æ®ç”¨æˆ·è¾“å…¥è¯­è¨€è‡ªåŠ¨åˆ‡æ¢ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
             - ä¸åŒ…å« XML æ ‡ç­¾
             - åŒ…å«æ¬¢è¿è¯­å’ŒåŠŸèƒ½è¯´æ˜
               è¿™ä¸‰ä¸ªæ¨¡æ¿åœ¨ generate_rule_config å‡½æ•°ä¸­é…åˆä½¿ç”¨ï¼š
         - ```python
                  RULE_CONFIG_STATEMENT_GENERATE_TEMPLATE = """
                  <instruction>
                  Step 1: Identify the purpose of the chatbot from the variable {{TASK_DESCRIPTION}} and infer chatbot's tone  (e.g., friendly, professional, etc.) to add personality traits. 
                  Step 2: Create a coherent and engaging opening statement.
                  Step 3: Ensure the output is welcoming and clearly explains what the chatbot is designed to do. Do not include any XML tags in the output.
                  Please use the same language as the user's input language. If user uses chinese then generate opening statement in chinese,  if user uses english then generate opening statement in english. 
                  Example Input: 
                  Provide customer support for an e-commerce website
                  Example Output: 
                  Welcome! I'm here to assist you with any questions or issues you might have with your shopping experience. Whether you're looking for product information, need help with your order, or have any other inquiries, feel free to ask. I'm friendly, helpful, and ready to support you in any way I can.
                  <Task>
                  Here is the task description: {{INPUT_TEXT}}

                  You just need to generate the output
                  """ 
           ```
         - ```plaintext
                ä¸­æ–‡ç¿»è¯‘ï¼š
                  <instruction>
                  æ­¥éª¤ 1ï¼šä»å˜é‡ {{TASK_DESCRIPTION}} ä¸­è¯†åˆ«èŠå¤©æœºå™¨äººçš„ç›®çš„ï¼Œå¹¶æ¨æ–­å…¶è¯­æ°”ï¼ˆä¾‹å¦‚ï¼šå‹å¥½çš„ã€ä¸“ä¸šçš„ç­‰ï¼‰ä»¥æ·»åŠ ä¸ªæ€§ç‰¹å¾ã€‚
                  æ­¥éª¤ 2ï¼šåˆ›å»ºä¸€ä¸ªè¿è´¯ä¸”å¸å¼•äººçš„å¼€åœºç™½ã€‚
                  æ­¥éª¤ 3ï¼šç¡®ä¿è¾“å‡ºå†…å®¹å‹å¥½ä¸”æ¸…æ™°åœ°è§£é‡ŠèŠå¤©æœºå™¨äººçš„åŠŸèƒ½ã€‚è¾“å‡ºä¸­ä¸è¦åŒ…å«ä»»ä½• XML æ ‡ç­¾ã€‚
                    
                  è¯·ä½¿ç”¨ä¸ç”¨æˆ·è¾“å…¥ç›¸åŒçš„è¯­è¨€ã€‚å¦‚æœç”¨æˆ·ä½¿ç”¨ä¸­æ–‡åˆ™ç”Ÿæˆä¸­æ–‡å¼€åœºç™½ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨è‹±æ–‡åˆ™ç”Ÿæˆè‹±æ–‡å¼€åœºç™½ã€‚
                    
                  ç¤ºä¾‹è¾“å…¥ï¼š
                  ä¸ºç”µå­å•†åŠ¡ç½‘ç«™æä¾›å®¢æˆ·æ”¯æŒ
                    
                  ç¤ºä¾‹è¾“å‡ºï¼š
                  æ¬¢è¿ï¼æˆ‘å¾ˆä¹æ„ä¸ºæ‚¨è§£ç­”ä»»ä½•è´­ç‰©ç›¸å…³çš„é—®é¢˜ã€‚æ— è®ºæ‚¨æ˜¯éœ€è¦äº§å“ä¿¡æ¯ã€è®¢å•å¸®åŠ©ï¼Œè¿˜æ˜¯æœ‰å…¶ä»–ç–‘é—®ï¼Œéƒ½å¯ä»¥éšæ—¶è¯¢é—®ã€‚æˆ‘ä¼šä»¥å‹å¥½ã€ä¸“ä¸šçš„æ€åº¦ä¸ºæ‚¨æä¾›å…¨æ–¹ä½çš„æ”¯æŒã€‚
                    
                  <Task>
                  è¿™æ˜¯ä»»åŠ¡æè¿°ï¼š{{INPUT_TEXT}}
                    
                  æ‚¨åªéœ€è¦ç”Ÿæˆè¾“å‡ºå†…å®¹
           ```  
  3.
      1. ç¬¬ä¸€ä¸ªæ¨¡æ¿ç”Ÿæˆä¸»è¦çš„æç¤ºç»“æ„
      2. ç¬¬äºŒä¸ªæ¨¡æ¿ä»ç”Ÿæˆçš„æç¤ºä¸­æå–å˜é‡
      3. ç¬¬ä¸‰ä¸ªæ¨¡æ¿ç”Ÿæˆå¼€åœºç™½
         å®ƒä»¬å…±åŒæ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„è§„åˆ™é…ç½®ç”Ÿæˆç³»ç»Ÿã€‚

- `generate_rule_config` å‡½æ•°çš„å·¥ä½œæµç¨‹ï¼š
  1. åˆå§‹åŒ–é˜¶æ®µ ï¼š
      - åˆ›å»ºä¸€ä¸ª rule_config å­—å…¸ï¼ŒåŒ…å« promptã€variablesã€opening_statement å’Œ error å­—æ®µ
      - è®¾ç½®æ¨¡å‹å‚æ•°ï¼ŒåŒ…æ‹¬ max_tokens å’Œè¾ƒä½çš„ temperatureï¼ˆ0.01ï¼‰ä»¥ç¡®ä¿è¾“å‡ºçš„ç¨³å®šæ€§
  - å½“ no_variable=True æ—¶çš„å¤„ç†æµç¨‹ ï¼š
      - ä½¿ç”¨ PromptTemplateParser å¤„ç† WORKFLOW_RULE_CONFIG_PROMPT_GENERATE_TEMPLATE æ¨¡æ¿
      - å°†ç”¨æˆ·çš„ instruction æ’å…¥åˆ°æ¨¡æ¿ä¸­çš„ {{TASK_DESCRIPTION}} ä½ç½®
      - è°ƒç”¨ LLM æ¨¡å‹ç”Ÿæˆå“åº”
      - å°†ç”Ÿæˆçš„å†…å®¹ä¿å­˜åˆ° rule_config["prompt"] ä¸­

  - å½“ no_variable=False æ—¶çš„å¤„ç†é€»è¾‘ï¼š
    1. è·å–æ ¼å¼æŒ‡ä»¤ ï¼š
       ```python
       #ä» RuleConfigGeneratorOutputParser è·å–ä¸‰ä¸ªä¸åŒçš„æ¨¡æ¿ï¼š
       #prompt_generateï¼šç”¨äºç”Ÿæˆä¸»è¦æç¤º
       #parameter_generateï¼šç”¨äºç”Ÿæˆå˜é‡
       #statement_generateï¼šç”¨äºç”Ÿæˆå¼€åœºç™½
       prompt_generate, parameter_generate, statement_generate = output_parser.get_format_instructions()
       ```
    2. åˆ›å»ºä¸‰ä¸ªæ¨¡æ¿è§£æå™¨ ï¼š
       ```python
       prompt_template = PromptTemplateParser(prompt_generate)
       parameter_template = PromptTemplateParser(parameter_generate)
       statement_template = PromptTemplateParser(statement_generate)
        ```

    3. ä¸‰æ­¥ç”Ÿæˆè¿‡ç¨‹ ï¼š
       1. ç¬¬ä¸€æ­¥ - ç”Ÿæˆä¸»æç¤º ï¼š
          ```python
          prompt_generate_prompt = prompt_template.format(
              inputs={"TASK_DESCRIPTION": instruction},
              remove_template_variables=False,
          )
          prompt_content = model_instance.invoke_llm(...)
          rule_config["prompt"] = prompt_content.message.content
           ```
       2. ç¬¬äºŒæ­¥ - ç”Ÿæˆå˜é‡ ï¼š
           ```python
           parameter_generate_prompt = parameter_template.format(
               inputs={"INPUT_TEXT": prompt_content.message.content},
               remove_template_variables=False,
           )
           parameter_content = model_instance.invoke_llm(...)
           rule_config["variables"] = re.findall(r'"\s*([^"]+)\s*"', parameter_content.message.content)
           ```
       3. ç¬¬ä¸‰æ­¥ - ç”Ÿæˆå¼€åœºç™½ ï¼š
          ```python
          statement_generate_prompt = statement_template.format(
              inputs={
                  "TASK_DESCRIPTION": instruction,
                  "INPUT_TEXT": prompt_content.message.content,
              },
              remove_template_variables=False,
          )
          statement_content = model_instance.invoke_llm(...)
          rule_config["opening_statement"] = statement_content.message.content
           ```
  - ä¸ no_variable=True çš„æƒ…å†µç›¸æ¯”ï¼Œè¿™ç§æ¨¡å¼ï¼š
    1. ç”Ÿæˆæ›´å¤æ‚çš„è§„åˆ™é…ç½®ï¼ŒåŒ…å«å˜é‡å’Œå¼€åœºç™½
    2. éœ€è¦å¤šæ¬¡è°ƒç”¨ LLM æ¨¡å‹ï¼ˆä¸‰æ¬¡ï¼‰
    3. æ¯ä¸€æ­¥çš„è¾“å‡ºä¼šä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥
    4. æœ€ç»ˆç”Ÿæˆçš„ rule_config åŒ…å«å®Œæ•´çš„ promptã€variables å’Œ opening_statement
       æ¯ä¸ªæ­¥éª¤éƒ½æœ‰ç‹¬ç«‹çš„é”™è¯¯å¤„ç†ï¼Œå¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œéƒ½ä¼šè®°å½•ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚


## metaSPO æºä»£ç åˆ†æ

### ç›¸å…³æ–‡ä»¶å’Œå˜é‡è§£é‡Š

#### 1. `Poem.yaml` æ–‡ä»¶è§£é‡Š

##### åŠŸèƒ½æ¦‚è¿°
`Poem.yaml` æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ç”Ÿæˆè¯—æ­Œçš„ä»»åŠ¡ã€‚å®ƒåŒ…å«æç¤ºï¼ˆpromptï¼‰ã€è¦æ±‚ï¼ˆrequirementsï¼‰ã€å­—æ•°é™åˆ¶ï¼ˆcountï¼‰ä»¥åŠé—®é¢˜-ç­”æ¡ˆå¯¹ï¼ˆqaï¼‰ã€‚è¿™äº›ä¿¡æ¯ç”¨äºæŒ‡å¯¼ LLM æ¨¡å‹ç”Ÿæˆç¬¦åˆè¦æ±‚çš„è¯—æ­Œã€‚

##### æ–‡ä»¶ç»“æ„
```yaml
prompt: |
  Create poetry in the requested style and format.

requirements: |
  None

count: None

qa:
  - question: |
      Write a modern sonnet about climate change
    answer: |
      None

  - question: |
      Create a haiku series about New York City
    answer: |
      None

  - question: |
      Write a free verse poem about social media
    answer: |
      None
```


##### è¯¦ç»†å­—æ®µè¯´æ˜
- **`prompt`**ï¼šå®šä¹‰äº†ä»»åŠ¡çš„åŸºæœ¬æç¤ºï¼ŒæŒ‡ç¤ºæ¨¡å‹åˆ›å»ºç¬¦åˆè¯·æ±‚é£æ ¼å’Œæ ¼å¼çš„è¯—æ­Œã€‚
- **`requirements`**ï¼šå½“å‰æ²¡æœ‰å…·ä½“çš„è¦æ±‚ï¼ˆè®¾ç½®ä¸º `None`ï¼‰ï¼Œæ„å‘³ç€ä»»åŠ¡è¾ƒä¸ºå¼€æ”¾ï¼Œä¸é™„åŠ é¢å¤–çº¦æŸã€‚
- **`count`**ï¼šå½“å‰æ²¡æœ‰å­—æ•°é™åˆ¶ï¼ˆè®¾ç½®ä¸º `None`ï¼‰ï¼Œæ„å‘³ç€ç”Ÿæˆçš„è¯—æ­Œé•¿åº¦ä¸å—é™åˆ¶ã€‚
- **`qa`**ï¼šåŒ…å«å¤šä¸ªé—®é¢˜-ç­”æ¡ˆå¯¹ï¼Œæ¯ä¸ªé—®é¢˜æ˜¯ä¸€ä¸ªå…·ä½“çš„è¯—æ­Œåˆ›ä½œä»»åŠ¡ï¼Œç­”æ¡ˆéƒ¨åˆ†ç›®å‰ä¸ºç©ºï¼ˆè®¾ç½®ä¸º `None`ï¼‰ï¼Œè¡¨ç¤ºå°šæœªç”Ÿæˆæˆ–æä¾›æ ‡å‡†ç­”æ¡ˆã€‚

#### 2. `optimize_prompt.py` æ–‡ä»¶è§£é‡Š

##### åŠŸèƒ½æ¦‚è¿°
`optimize_prompt.py` å®šä¹‰äº†ä¸€ä¸ªä¼˜åŒ–æç¤ºæ¨¡æ¿ (`PROMPT_OPTIMIZE_PROMPT`)ï¼Œç”¨äºæŒ‡å¯¼ LLM æ¨¡å‹ä¼˜åŒ–ç°æœ‰æç¤ºã€‚è¯¥æ¨¡æ¿åŒ…å«äº†ä»»åŠ¡è¦æ±‚ã€å‚è€ƒæç¤ºã€æ‰§è¡Œç»“æœå’ŒæœŸæœ›çš„æœ€ä½³ç­”æ¡ˆï¼Œå¹¶è¦æ±‚æ¨¡å‹åˆ†æç°æœ‰ç»“æœçš„ä¸è¶³å¹¶æå‡ºæ”¹è¿›å»ºè®®ã€‚

##### å…³é”®ä»£ç ç‰‡æ®µ
```python
PROMPT_OPTIMIZE_PROMPT = """
You are building a prompt to address user requirement. Based on the given prompt, 
please reconstruct and optimize it. You can add, modify, or delete prompts. Please include a single modification in 
XML tags in your reply. During the optimization, you can incorporate any thinking models.
This is a prompt that performed excellently in a previous iteration. You must make further optimizations and improvements based on this prompt. The modified prompt must differ from the provided example.

requirements:
```

{requirements}
```
reference prompt:
```

{prompt}
```
The execution result of this reference prompt is(some cases):
```

{answers}
```
The best answer we expect(some cases):
```

{golden_answers}
```
Provide your analysis, optimization points, and the complete optimized prompt using the following XML format:

<analyse>Analyze what drawbacks exist in the results produced by the reference prompt and how to improve them.</analyse>
<modification>Summarize the key points for improvement in one sentence</modification>
<prompt>Provide the complete optimized prompt {count}</prompt>
"""
```


##### è¯¦ç»†å­—æ®µè¯´æ˜
- **`requirements`**ï¼šç”¨æˆ·çš„å…·ä½“è¦æ±‚ï¼Œä½œä¸ºä¼˜åŒ–çš„ä¾æ®ã€‚
- **`prompt`**ï¼šéœ€è¦ä¼˜åŒ–çš„å‚è€ƒæç¤ºã€‚
- **`answers`**ï¼šå‚è€ƒæç¤ºçš„æ‰§è¡Œç»“æœï¼Œå¸®åŠ©è¯†åˆ«ç°æœ‰æç¤ºçš„é—®é¢˜ã€‚
- **`golden_answers`**ï¼šæœŸæœ›çš„æœ€ä½³ç­”æ¡ˆï¼Œä½œä¸ºä¼˜åŒ–çš„ç›®æ ‡ã€‚
- **`analyse`**ï¼šè¦æ±‚æ¨¡å‹åˆ†æç°æœ‰ç»“æœçš„ä¸è¶³ä¹‹å¤„ã€‚
- **`modification`**ï¼šè¦æ±‚æ¨¡å‹æ€»ç»“æ”¹è¿›çš„å…³é”®ç‚¹ã€‚
- **`prompt`**ï¼šè¦æ±‚æ¨¡å‹æä¾›å®Œæ•´çš„ä¼˜åŒ–åæç¤ºã€‚

#### 3. `evaluate_prompt.py` æ–‡ä»¶è§£é‡Š

##### åŠŸèƒ½æ¦‚è¿°
`evaluate_prompt.py` å®šä¹‰äº†ä¸€ä¸ªè¯„ä¼°æç¤ºæ¨¡æ¿ (`EVALUATE_PROMPT`)ï¼Œç”¨äºæŒ‡å¯¼ LLM æ¨¡å‹æ¯”è¾ƒä¸¤ä¸ªä¸åŒæç¤ºåŠå…¶ç­”æ¡ˆçš„è´¨é‡ï¼Œå¹¶é€‰æ‹©æ›´ä¼˜çš„ä¸€ä¸ªã€‚è¯¥æ¨¡æ¿åŒ…å«äº†ä»»åŠ¡è¦æ±‚ã€ä¸¤ä¸ªæ ·æœ¬ï¼ˆA å’Œ Bï¼‰ã€å‚è€ƒç­”æ¡ˆï¼Œå¹¶è¦æ±‚æ¨¡å‹è¿›è¡Œåˆ†æå’Œé€‰æ‹©ã€‚

##### å…³é”®ä»£ç ç‰‡æ®µ
```python
EVALUATE_PROMPT = """
Based on the original requirements, evaluate the two responses, A and B, and determine which one better meets the requirements. If a reference answer is provided, strictly follow the format/content of the reference answer.

# Requirement
{requirement}

# A
{sample}

# B
{new_sample}

# Golden answer
{answers}

Provide your analysis and the choice you believe is better, using XML tags to encapsulate your response.

<analyse>Some analysis</analyse>
<choose>A/B (the better answer in your opinion)</choose>
"""
```


##### è¯¦ç»†å­—æ®µè¯´æ˜
- **`requirement`**ï¼šåŸå§‹ä»»åŠ¡è¦æ±‚ï¼Œä½œä¸ºè¯„ä¼°çš„ä¾æ®ã€‚
- **`sample`**ï¼šç¬¬ä¸€ä¸ªæ ·æœ¬ï¼ˆAï¼‰ï¼Œå³ä¹‹å‰çš„æç¤ºåŠå…¶ç­”æ¡ˆã€‚
- **`new_sample`**ï¼šç¬¬äºŒä¸ªæ ·æœ¬ï¼ˆBï¼‰ï¼Œå³æ–°ç”Ÿæˆçš„æç¤ºåŠå…¶ç­”æ¡ˆã€‚
- **`answers`**ï¼šå‚è€ƒç­”æ¡ˆï¼Œä½œä¸ºè¯„ä¼°çš„æ ‡å‡†ã€‚
- **`analyse`**ï¼šè¦æ±‚æ¨¡å‹åˆ†æä¸¤ä¸ªæ ·æœ¬çš„ä¼˜åŠ£ã€‚
- **`choose`**ï¼šè¦æ±‚æ¨¡å‹é€‰æ‹©æ›´ä¼˜çš„æ ·æœ¬ï¼ˆA æˆ– Bï¼‰ã€‚

### `_optimize_prompt` å‡½æ•°æµç¨‹å›¾

ä¸ºäº†æ›´æ¸…æ™°åœ°å±•ç¤º `_optimize_prompt` å‡½æ•°çš„æ‰§è¡Œæµç¨‹ï¼Œä»¥ä¸‹æ˜¯åŸºäºå…¶é€»è¾‘ç»˜åˆ¶çš„è¯¦ç»†æµç¨‹å›¾ï¼š

```mermaid
graph TD
    A[å¼€å§‹ä¼˜åŒ–è½®æ¬¡] --> B{æ˜¯å¦ä¸ºç¬¬ä¸€è½®?}
    B -- æ˜¯ --> C[å¤„ç†ç¬¬ä¸€è½®ä¼˜åŒ–]
    C --> D[è¿”å›å¹¶ç»“æŸæœ¬è½®]
    B -- å¦ --> E[åˆ›å»ºæœ¬è½®ç›®å½•]
    E --> F[ç”Ÿæˆæ–°æç¤º]
    F --> G[è®°å½•æ—¥å¿—å’Œä¿å­˜æç¤º]
    G --> H[æ‰§è¡Œæ–°æç¤º]
    H --> I[è¯„ä¼°æ–°æç¤º]
    I --> J[ä¿å­˜è¯„ä¼°ç»“æœ]
    J --> K[è®°å½•ä¼˜åŒ–ç»“æœ]
    K --> L[ç»“æŸæœ¬è½®]

    subgraph å¤„ç†ç¬¬ä¸€è½®ä¼˜åŒ–
        C --> C1[åˆ›å»ºç¬¬ä¸€è½®ç›®å½•]
        C1 --> C2[åŠ è½½åˆå§‹æç¤º]
        C2 --> C3[å†™å…¥åˆå§‹æç¤º]
        C3 --> C4[æ‰§è¡Œåˆå§‹æç¤º]
        C4 --> C5[è¯„ä¼°åˆå§‹æç¤º]
        C5 --> C6[ä¿å­˜è¯„ä¼°ç»“æœ]
    end

    subgraph è¯„ä¼°æ–°æç¤º
        I --> I1[è·å–æœ€ä½³å†å²æç¤º]
        I1 --> I2[è°ƒç”¨è¯„ä¼°æ–¹æ³•]
        I2 --> I3[æ¯”è¾ƒæ–°æ—§æç¤ºæ•ˆæœ]
        I3 --> I4[è¿”å›è¯„ä¼°ç»“æœ]
    end
```

### `_optimize_prompt` å‡½æ•°é€»è¾‘è¯¦ç»†è§£é‡Š

`_optimize_prompt` æ˜¯ `PromptOptimizer` ç±»ä¸­çš„ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œæ¯ä¸ªä¼˜åŒ–è½®æ¬¡çš„æ ¸å¿ƒé€»è¾‘ã€‚ä»¥ä¸‹æ˜¯è¯¥å‡½æ•°çš„è¯¦ç»†æ­¥éª¤æ‹†åˆ†ï¼š

#### 1. åŠ è½½å·²æœ‰æ•°æ®
```python
prompt_path = self.root_path / "prompts"
load.set_file_name(self.template)
data = self.data_utils.load_results(prompt_path)
```

- **è¯´æ˜**ï¼šè®¾ç½®å½“å‰ä¼˜åŒ–ä»»åŠ¡çš„æ¨¡æ¿æ–‡ä»¶åï¼Œå¹¶åŠ è½½ä¹‹å‰è½®æ¬¡çš„ç»“æœæ•°æ®ã€‚
- **ä½œç”¨**ï¼šç¡®ä¿æ¯æ¬¡ä¼˜åŒ–æ—¶éƒ½èƒ½åŸºäºå†å²æ•°æ®è¿›è¡Œæ”¹è¿›ã€‚

#### 2. å¤„ç†ç¬¬ä¸€è½®ä¼˜åŒ–
```python
if self.round == 1:
    await self._handle_first_round(prompt_path, data)
    return
```

- **è¯´æ˜**ï¼šå¦‚æœå½“å‰æ˜¯ç¬¬ä¸€è½®ä¼˜åŒ–ï¼Œåˆ™è°ƒç”¨ `_handle_first_round` æ–¹æ³•å¤„ç†åˆå§‹è½®æ¬¡ã€‚
- **ä½œç”¨**ï¼šåˆå§‹åŒ–ä¼˜åŒ–è¿‡ç¨‹ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„æç¤ºå¹¶è¯„ä¼°å…¶æ•ˆæœã€‚

#### 3. åˆ›å»ºæœ¬è½®ç›®å½•
```python
directory = self.prompt_utils.create_round_directory(prompt_path, self.round)
new_prompt = await self._generate_optimized_prompt()
self.prompt = new_prompt
```

- **è¯´æ˜**ï¼šä¸ºå½“å‰è½®æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•ï¼Œå¹¶ç”Ÿæˆä¼˜åŒ–åçš„æç¤ºã€‚
- **ä½œç”¨**ï¼šç¡®ä¿æ¯ä¸€è½®ä¼˜åŒ–éƒ½æœ‰ç‹¬ç«‹çš„å·¥ä½œç©ºé—´ï¼Œå¹¶ç”Ÿæˆæ–°çš„æç¤ºä»¥ä¾›æµ‹è¯•ã€‚

#### 4. è®°å½•æ—¥å¿—å’Œä¿å­˜æç¤º
```python
logger.info(f"\nRound {self.round} Prompt: {self.prompt}\n")
self.prompt_utils.write_prompt(directory, prompt=self.prompt)
```

- **è¯´æ˜**ï¼šè®°å½•å½“å‰è½®æ¬¡çš„æç¤ºå†…å®¹ï¼Œå¹¶å°†å…¶å†™å…¥æ–‡ä»¶ã€‚
- **ä½œç”¨**ï¼šä¾¿äºåç»­æŸ¥çœ‹å’Œè°ƒè¯•ï¼ŒåŒæ—¶ç¡®ä¿æç¤ºå¯ä»¥æŒä¹…åŒ–ä¿å­˜ã€‚

#### 5. æ‰§è¡Œæ–°æç¤º
```python
success, answers = await self._evaluate_new_prompt(prompt_path, data, directory)
```

- **è¯´æ˜**ï¼šè°ƒç”¨ `_evaluate_new_prompt` æ–¹æ³•æ¥æ‰§è¡Œæ–°ç”Ÿæˆçš„æç¤ºï¼Œå¹¶è¯„ä¼°å…¶æ•ˆæœã€‚
- **ä½œç”¨**ï¼šé€šè¿‡å®é™…è¿è¡Œæ–°æç¤ºï¼Œæ”¶é›†ç»“æœå¹¶è¯„ä¼°å…¶æ€§èƒ½ã€‚

#### 6. è®°å½•ä¼˜åŒ–ç»“æœ
```python
self._log_optimization_result(success)
```

- **è¯´æ˜**ï¼šæ ¹æ®è¯„ä¼°ç»“æœè®°å½•ä¼˜åŒ–æ˜¯å¦æˆåŠŸã€‚
- **ä½œç”¨**ï¼šæä¾›æ¸…æ™°çš„æ—¥å¿—è¾“å‡ºï¼Œå¸®åŠ©ç†è§£ä¼˜åŒ–è¿‡ç¨‹çš„æ•ˆæœã€‚

### `_evaluate_new_prompt` å‡½æ•°é€»è¾‘è¯¦ç»†è§£é‡Š

`_evaluate_new_prompt` å‡½æ•°è´Ÿè´£æ‰§è¡Œæ–°ç”Ÿæˆçš„æç¤ºï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¯„ä¼°ã€‚ä»¥ä¸‹æ˜¯è¯¥å‡½æ•°çš„è¯¦ç»†æ­¥éª¤æ‹†åˆ†ï¼š

#### 1. æ‰§è¡Œæ–°æç¤º
```python
logger.info("\nâš¡ RUNNING OPTIMIZED PROMPT âš¡\n")
new_samples = await self.evaluation_utils.execute_prompt(self, directory)
```

- **è¯´æ˜**ï¼šè®°å½•æ—¥å¿—å¹¶æ‰§è¡Œæ–°ç”Ÿæˆçš„æç¤ºã€‚
- **ä½œç”¨**ï¼šå®é™…è¿è¡Œæ–°æç¤ºï¼Œè·å–å…¶è¾“å‡ºç»“æœã€‚

#### 2. è¯„ä¼°æ–°æç¤º
```python
logger.info("\nğŸ“Š EVALUATING OPTIMIZED PROMPT ğŸ“Š\n")
samples = self.data_utils.get_best_round()
success, answers = await self.evaluation_utils.evaluate_prompt(
    self, samples, new_samples, path=prompt_path, data=data, initial=False
)
```

- **è¯´æ˜**ï¼šè®°å½•æ—¥å¿—å¹¶è°ƒç”¨ `evaluate_prompt` æ–¹æ³•å¯¹æ–°æç¤ºè¿›è¡Œè¯„ä¼°ã€‚
- **ä½œç”¨**ï¼šæ¯”è¾ƒæ–°æç¤ºä¸æœ€ä½³å†å²æç¤ºçš„è¡¨ç°ï¼Œç¡®å®šæ–°æç¤ºæ˜¯å¦æ›´ä¼˜ã€‚

#### 3. ä¿å­˜ç­”æ¡ˆ
```python
self.prompt_utils.write_answers(directory, answers=answers)
```

- **è¯´æ˜**ï¼šå°†è¯„ä¼°ç»“æœï¼ˆç­”æ¡ˆï¼‰ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚
- **ä½œç”¨**ï¼šç¡®ä¿è¯„ä¼°ç»“æœå¯ä»¥æŒä¹…åŒ–ä¿å­˜ï¼Œä¾¿äºåç»­åˆ†æå’Œå‚è€ƒã€‚

#### 4. è¿”å›è¯„ä¼°ç»“æœ
```python
return success, answers
```

- **è¯´æ˜**ï¼šè¿”å›è¯„ä¼°ç»“æœï¼ŒåŒ…æ‹¬æ˜¯å¦æˆåŠŸå’Œå…·ä½“çš„ç­”æ¡ˆã€‚
- **ä½œç”¨**ï¼šä¸ºä¸Šå±‚è°ƒç”¨è€…æä¾›è¯„ä¼°ç»“æœï¼Œä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†æˆ–è®°å½•ã€‚

### `_generate_optimized_prompt` å‡½æ•°è§£é‡Š

#### åŠŸèƒ½æ¦‚è¿°
`_generate_optimized_prompt` æ˜¯ `PromptOptimizer` ç±»ä¸­çš„ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºç”Ÿæˆä¼˜åŒ–åçš„æ–°æç¤ºï¼ˆpromptï¼‰ã€‚è¯¥æ–¹æ³•åœ¨æ¯æ¬¡ä¼˜åŒ–è½®æ¬¡ä¸­è°ƒç”¨ï¼Œé€šè¿‡åˆ†æå‰ä¸€è½®çš„æœ€ä½³ç»“æœå’Œä¸€äº›é…ç½®ä¿¡æ¯æ¥ç”Ÿæˆæ–°çš„æç¤ºã€‚

#### è¯¦ç»†æ­¥éª¤
1. **åŠ è½½å…ƒæ•°æ®**ï¼š
    - ä½¿ç”¨ `load.load_meta_data()` åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„è¦æ±‚ (`requirements`)ã€é—®é¢˜-ç­”æ¡ˆå¯¹ (`qa`) å’Œå­—æ•°é™åˆ¶ (`count`)ã€‚

2. **è·å–æœ€ä½³è½®æ¬¡çš„ç»“æœ**ï¼š
    - è°ƒç”¨ `self.data_utils.get_best_round()` è·å–ä¹‹å‰è½®æ¬¡ä¸­è¡¨ç°æœ€å¥½çš„ç»“æœã€‚è¿™åŒ…æ‹¬æœ€ä½³è½®æ¬¡çš„æç¤º (`samples["prompt"]`) å’Œå…¶å¯¹åº”çš„ç­”æ¡ˆ (`samples["answers"]`)ã€‚

3. **æ—¥å¿—è®°å½•**ï¼š
    - è®°å½•å½“å‰è½®æ¬¡çš„ä¼˜åŒ–å¼€å§‹ä¿¡æ¯ï¼Œå¹¶æŒ‡å®šä½¿ç”¨çš„æ˜¯å“ªä¸€è½®çš„æœ€ä½³ç»“æœä½œä¸ºåŸºç¡€ã€‚

4. **å°†é—®é¢˜-ç­”æ¡ˆå¯¹è½¬æ¢ä¸º Markdown æ ¼å¼**ï¼š
    - ä½¿ç”¨ `self.data_utils.list_to_markdown(qa)` å°†é—®é¢˜-ç­”æ¡ˆå¯¹è½¬æ¢ä¸º Markdown æ ¼å¼çš„å­—ç¬¦ä¸² (`golden_answer`)ã€‚
    - åŒæ ·åœ°ï¼Œå°†æœ€ä½³è½®æ¬¡çš„ç­”æ¡ˆè½¬æ¢ä¸º Markdown æ ¼å¼çš„å­—ç¬¦ä¸² (`best_answer`)ã€‚

5. **æ„å»ºä¼˜åŒ–æç¤ºæ¨¡æ¿**ï¼š
    - ä½¿ç”¨ `PROMPT_OPTIMIZE_PROMPT.format(...)` æ„å»ºä¼˜åŒ–æç¤ºçš„æ¨¡æ¿ã€‚è¿™ä¸ªæ¨¡æ¿åŒ…å«äº†ä»¥ä¸‹å†…å®¹ï¼š
        - å½“å‰è½®æ¬¡çš„æœ€ä½³æç¤º (`samples["prompt"]`)
        - æœ€ä½³è½®æ¬¡çš„ç­”æ¡ˆ (`best_answer`)
        - é…ç½®æ–‡ä»¶ä¸­çš„è¦æ±‚ (`requirements`)
        - é—®é¢˜-ç­”æ¡ˆå¯¹çš„é»„é‡‘æ ‡å‡† (`golden_answer`)
        - å­—æ•°é™åˆ¶ (`count`)

6. **å‘é€è¯·æ±‚ç»™ LLM æ¨¡å‹**ï¼š
    - ä½¿ç”¨ `await self.llm.responser(...)` å‘ LLM æ¨¡å‹å‘é€ä¼˜åŒ–æç¤ºæ¨¡æ¿ï¼Œè¯·æ±‚æ¨¡å‹ç”Ÿæˆæ–°çš„ä¼˜åŒ–åçš„æç¤ºã€‚
    - æå–å“åº”ä¸­çš„ä¿®æ”¹å»ºè®® (`modification`) å’Œæ–°æç¤º (`prompt`)ã€‚

7. **è¿”å›æ–°æç¤º**ï¼š
    - å¦‚æœä»å“åº”ä¸­æˆåŠŸæå–äº†æ–°æç¤ºï¼Œåˆ™è¿”å›è¯¥æç¤ºï¼›å¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚

#### å…³é”®ä»£ç ç‰‡æ®µ
```python
async def _generate_optimized_prompt(self):
    _, requirements, qa, count = load.load_meta_data()
    samples = self.data_utils.get_best_round()

    logger.info(f"\nğŸš€ Round {self.round} OPTIMIZATION STARTING ğŸš€\n")
    logger.info(f"\nSelecting prompt for round {samples['round']} and advancing to the iteration phase\n")

    golden_answer = self.data_utils.list_to_markdown(qa)
    best_answer = self.data_utils.list_to_markdown(samples["answers"])

    optimize_prompt = PROMPT_OPTIMIZE_PROMPT.format(
        prompt=samples["prompt"],
        answers=best_answer,
        requirements=requirements,
        golden_answers=golden_answer,
        count=count,
    )

    response = await self.llm.responser(
        request_type=RequestType.OPTIMIZE, messages=[{"role": "user", "content": optimize_prompt}]
    )

    modification = extract_content(response, "modification")
    logger.info(f"Modification of {self.round} round: {modification}")

    prompt = extract_content(response, "prompt")
    return prompt if prompt else ""
```


#### æ€»ç»“
`_generate_optimized_prompt` æ–¹æ³•çš„æ ¸å¿ƒåœ¨äºé€šè¿‡å†å²æ•°æ®å’Œé…ç½®ä¿¡æ¯æ„å»ºä¼˜åŒ–æç¤ºæ¨¡æ¿ï¼Œå¹¶å€ŸåŠ© LLM æ¨¡å‹ç”Ÿæˆæ–°çš„ä¼˜åŒ–æç¤ºã€‚è¿™ä¸€è¿‡ç¨‹ç¡®ä¿äº†æ¯æ¬¡ä¼˜åŒ–è½®æ¬¡éƒ½èƒ½åŸºäºä¹‹å‰çš„æœ€ä½³ç»“æœè¿›è¡Œæ”¹è¿›ï¼Œä»è€Œé€æ­¥æå‡æç¤ºçš„è´¨é‡ã€‚

### `execute_prompt` æ–¹æ³•è§£é‡Š

##### åŠŸèƒ½æ¦‚è¿°
`execute_prompt` æ˜¯ `EvaluationUtils` ç±»ä¸­çš„ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œç»™å®šçš„æç¤ºï¼ˆpromptï¼‰ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚è¯¥æ–¹æ³•ä¸»è¦ç”¨äºç”Ÿæˆæ–°çš„æ ·æœ¬æ•°æ®ï¼Œè¿™äº›æ•°æ®å°†ç”¨äºåç»­çš„è¯„ä¼°ã€‚

##### è¯¦ç»†æ­¥éª¤
1. **åŠ è½½æç¤º**ï¼š
    - ä½¿ç”¨ `optimizer.prompt_utils.load_prompt(optimizer.round, prompt_path)` åŠ è½½å½“å‰è½®æ¬¡çš„æç¤ºã€‚

2. **åˆå§‹åŒ–æ‰§è¡Œå™¨**ï¼š
    - åˆ›å»º `QuickExecute` å®ä¾‹ï¼Œå¹¶ä¼ å…¥åŠ è½½çš„æç¤ºã€‚

3. **æ‰§è¡Œæç¤º**ï¼š
    - è°ƒç”¨ `executor.prompt_execute()` å¼‚æ­¥æ‰§è¡Œæç¤ºï¼Œè·å–æ‰§è¡Œç»“æœï¼ˆç­”æ¡ˆï¼‰ã€‚

4. **æ„å»ºæ–°æ•°æ®ç»“æ„**ï¼š
    - å°†å½“å‰è½®æ¬¡ã€ç­”æ¡ˆå’Œæç¤ºå°è£…åˆ°ä¸€ä¸ªæ–°çš„å­—å…¸ `new_data` ä¸­ï¼Œä»¥ä¾¿åç»­å¤„ç†ã€‚

5. **è¿”å›ç»“æœ**ï¼š
    - è¿”å›åŒ…å«è½®æ¬¡ã€ç­”æ¡ˆå’Œæç¤ºçš„æ–°æ•°æ®å­—å…¸ã€‚

##### å…³é”®ä»£ç ç‰‡æ®µ
```python
async def execute_prompt(self, optimizer: Any, prompt_path: Path) -> dict:
    optimizer.prompt = optimizer.prompt_utils.load_prompt(optimizer.round, prompt_path)
    executor = QuickExecute(prompt=optimizer.prompt)

    answers = await executor.prompt_execute()

    cur_round = optimizer.round

    new_data = {"round": cur_round, "answers": answers, "prompt": optimizer.prompt}

    return new_data
```

### `evaluate_prompt` æ–¹æ³•è§£é‡Š

##### åŠŸèƒ½æ¦‚è¿°
`evaluate_prompt` æ˜¯ `EvaluationUtils` ç±»ä¸­çš„å¦ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè¯„ä¼°æ–°ç”Ÿæˆçš„æç¤ºåŠå…¶ç­”æ¡ˆçš„è´¨é‡ã€‚è¯¥æ–¹æ³•ä¼šæ ¹æ®é…ç½®é‡å¤è¯„ä¼°å¤šæ¬¡ï¼Œå¹¶æ ¹æ®å¤šæ•°æŠ•ç¥¨åŸåˆ™ç¡®å®šè¯„ä¼°ç»“æœæ˜¯å¦æˆåŠŸã€‚æœ€ç»ˆï¼Œå®ƒä¼šä¿å­˜è¯„ä¼°ç»“æœå¹¶è¿”å›è¯„ä¼°çŠ¶æ€å’Œç­”æ¡ˆã€‚

##### è¯¦ç»†æ­¥éª¤
1. **åˆå§‹åŒ–è¯„ä¼°å™¨**ï¼š
    - åˆ›å»º `QuickEvaluate` å®ä¾‹ï¼Œç”¨äºæ‰§è¡Œè¯„ä¼°é€»è¾‘ã€‚

2. **è®¡ç®—æ–°æ ·æœ¬çš„ä»¤ç‰Œæ•°**ï¼š
    - ä½¿ç”¨ `count_tokens(new_samples)` è®¡ç®—æ–°æ ·æœ¬ä¸­ç­”æ¡ˆéƒ¨åˆ†çš„ä»¤ç‰Œæ•°é‡ã€‚

3. **åˆ¤æ–­æ˜¯å¦ä¸ºåˆå§‹è½®æ¬¡**ï¼š
    - å¦‚æœæ˜¯åˆå§‹è½®æ¬¡ (`initial=True`)ï¼Œåˆ™ç›´æ¥è®¾ç½®è¯„ä¼°ç»“æœä¸ºæˆåŠŸ (`succeed=True`)ã€‚
    - å¦åˆ™ï¼Œè¿›è¡Œå¤šæ¬¡è¯„ä¼°ï¼ˆé»˜è®¤é‡å¤ `EVALUATION_REPETITION` æ¬¡ï¼‰ï¼Œå¹¶å°†æ¯æ¬¡è¯„ä¼°çš„ç»“æœå­˜å‚¨åœ¨ `evaluation_results` åˆ—è¡¨ä¸­ã€‚

4. **ç»Ÿè®¡è¯„ä¼°ç»“æœ**ï¼š
    - ç»Ÿè®¡ `evaluation_results` åˆ—è¡¨ä¸­ `True` å’Œ `False` çš„æ¬¡æ•°ã€‚
    - æ ¹æ®å¤šæ•°æŠ•ç¥¨åŸåˆ™ç¡®å®šæœ€ç»ˆçš„è¯„ä¼°ç»“æœï¼šå¦‚æœ `True` çš„æ¬¡æ•°å¤šäº `False`ï¼Œåˆ™è¯„ä¼°æˆåŠŸï¼›å¦åˆ™å¤±è´¥ã€‚

5. **åˆ›å»ºç»“æœæ•°æ®**ï¼š
    - ä½¿ç”¨ `optimizer.data_utils.create_result_data(...)` åˆ›å»ºåŒ…å«è½®æ¬¡ã€ç­”æ¡ˆã€æç¤ºã€è¯„ä¼°ç»“æœå’Œä»¤ç‰Œæ•°çš„ç»“æœæ•°æ®ã€‚

6. **ä¿å­˜ç»“æœ**ï¼š
    - å°†æ–°ç»“æœæ•°æ®æ·»åŠ åˆ°ç°æœ‰æ•°æ®åˆ—è¡¨ä¸­ï¼Œå¹¶ä½¿ç”¨ `optimizer.data_utils.save_results(...)` å°†å…¶ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„ã€‚

7. **è¿”å›è¯„ä¼°ç»“æœå’Œç­”æ¡ˆ**ï¼š
    - è¿”å›è¯„ä¼°ç»“æœï¼ˆå¸ƒå°”å€¼ï¼‰å’Œæ–°æ ·æœ¬çš„ç­”æ¡ˆã€‚

##### å…³é”®ä»£ç ç‰‡æ®µ
```python
async def evaluate_prompt(
    self,
    optimizer: Any,
    samples: Optional[dict],
    new_samples: dict,
    path: Path,
    data: List[dict],
    initial: bool = False,
) -> Tuple[bool, dict]:
    evaluator = QuickEvaluate()
    new_token = count_tokens(new_samples)

    if initial is True:
        succeed = True
    else:
        evaluation_results = []

        evaluation_results.extend(
            await asyncio.gather(
                *(
                    evaluator.prompt_evaluate(samples=samples, new_samples=new_samples)
                    for _ in range(EVALUATION_REPETITION)
                )
            )
        )

        logger.info(f"Evaluation Results {evaluation_results}")

        true_count = evaluation_results.count(True)
        false_count = evaluation_results.count(False)
        succeed = true_count > false_count

    new_data = optimizer.data_utils.create_result_data(
        new_samples["round"], new_samples["answers"], new_samples["prompt"], succeed, new_token
    )

    data.append(new_data)

    result_path = optimizer.data_utils.get_results_file_path(path)

    optimizer.data_utils.save_results(result_path, data)

    answers = new_samples["answers"]

    return succeed, answers
```

### `prompt_execute` æ–¹æ³•è§£é‡Š

##### åŠŸèƒ½æ¦‚è¿°
`prompt_execute` æ˜¯ `QuickExecute` ç±»ä¸­çš„ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œç»™å®šçš„æç¤ºï¼ˆpromptï¼‰ï¼Œå¹¶è¿”å›æ¯ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚è¯¥æ–¹æ³•ä¸»è¦ç”¨äºç”Ÿæˆæ–°çš„æ ·æœ¬æ•°æ®ï¼Œè¿™äº›æ•°æ®å°†ç”¨äºåç»­çš„è¯„ä¼°ã€‚

##### è¯¦ç»†æ­¥éª¤
1. **åŠ è½½å…ƒæ•°æ®**ï¼š
    - ä½¿ç”¨ `load.load_meta_data()` åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„é—®é¢˜-ç­”æ¡ˆå¯¹ (`qa`)ã€‚

2. **å®šä¹‰å¼‚æ­¥ä»»åŠ¡**ï¼š
    - å®šä¹‰ä¸€ä¸ªå†…éƒ¨å¼‚æ­¥å‡½æ•° `fetch_answer(q: str)`ï¼Œç”¨äºä¸ºæ¯ä¸ªé—®é¢˜ç”Ÿæˆç­”æ¡ˆã€‚
        - æ„å»ºæ¶ˆæ¯åˆ—è¡¨ `messages`ï¼ŒåŒ…å«ç”¨æˆ·è§’è‰²å’Œå†…å®¹ï¼ˆæç¤º + é—®é¢˜ï¼‰ã€‚
        - ä½¿ç”¨ `await self.llm.responser(...)` å‘ LLM æ¨¡å‹å‘é€è¯·æ±‚ï¼Œè·å–ç­”æ¡ˆã€‚
        - å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œæ•è·å¼‚å¸¸å¹¶å°†é”™è¯¯ä¿¡æ¯ä½œä¸ºç­”æ¡ˆè¿”å›ã€‚

3. **å¹¶å‘æ‰§è¡Œä»»åŠ¡**ï¼š
    - ä½¿ç”¨ `asyncio.gather(*tasks)` å¹¶å‘æ‰§è¡Œæ‰€æœ‰é—®é¢˜çš„å›ç­”ä»»åŠ¡ï¼Œæé«˜æ•ˆç‡ã€‚

4. **è¿”å›ç»“æœ**ï¼š
    - è¿”å›åŒ…å«æ‰€æœ‰é—®é¢˜åŠå…¶å¯¹åº”ç­”æ¡ˆçš„åˆ—è¡¨ã€‚

##### å…³é”®ä»£ç ç‰‡æ®µ
```python
class QuickExecute:
    def __init__(self, prompt: str):
        self.prompt = prompt
        self.llm = SPO_LLM.get_instance()

    async def prompt_execute(self) -> tuple[Any]:
        _, _, qa, _ = load.load_meta_data()
        answers = []

        async def fetch_answer(q: str) -> Dict[str, Any]:
            messages = [{"role": "user", "content": f"{self.prompt}\n\n{q}"}]
            try:
                answer = await self.llm.responser(request_type=RequestType.EXECUTE, messages=messages)
                return {"question": q, "answer": answer}
            except Exception as e:
                return {"question": q, "answer": str(e)}

        tasks = [fetch_answer(item["question"]) for item in qa]
        answers = await asyncio.gather(*tasks)

        return answers
```

### `prompt_evaluate` æ–¹æ³•è§£é‡Š

##### åŠŸèƒ½æ¦‚è¿°
`prompt_evaluate` æ˜¯ `QuickEvaluate` ç±»ä¸­çš„ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè¯„ä¼°ä¸¤ä¸ªä¸åŒæç¤ºåŠå…¶ç­”æ¡ˆçš„è´¨é‡ã€‚è¯¥æ–¹æ³•é€šè¿‡éšæœºäº¤æ¢æ ·æœ¬é¡ºåºï¼Œå¹¶ä½¿ç”¨ LLM æ¨¡å‹è¿›è¡Œæ¯”è¾ƒï¼Œæœ€ç»ˆæ ¹æ®æ¨¡å‹çš„é€‰æ‹©ç¡®å®šè¯„ä¼°ç»“æœã€‚

##### è¯¦ç»†æ­¥éª¤
1. **åŠ è½½å…ƒæ•°æ®**ï¼š
    - ä½¿ç”¨ `load.load_meta_data()` åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„è¦æ±‚ (`requirement`) å’Œé—®é¢˜-ç­”æ¡ˆå¯¹ (`qa`)ã€‚

2. **éšæœºäº¤æ¢æ ·æœ¬**ï¼š
    - éšæœºå†³å®šæ˜¯å¦äº¤æ¢ `samples` å’Œ `new_samples` çš„é¡ºåºï¼Œä»¥ç¡®ä¿è¯„ä¼°çš„å…¬å¹³æ€§ã€‚
    - è®°å½•æ˜¯å¦è¿›è¡Œäº†äº¤æ¢ (`is_swapped`)ã€‚

3. **æ„å»ºè¯„ä¼°æç¤º**ï¼š
    - ä½¿ç”¨ `EVALUATE_PROMPT.format(...)` æ„å»ºè¯„ä¼°æç¤ºæ¨¡æ¿ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
        - è¦æ±‚ (`requirement`)
        - æ ·æœ¬ (`sample`)
        - æ–°æ ·æœ¬ (`new_sample`)
        - é—®é¢˜-ç­”æ¡ˆå¯¹ (`answers`)

4. **å‘é€è¯·æ±‚ç»™ LLM æ¨¡å‹**ï¼š
    - ä½¿ç”¨ `await self.llm.responser(...)` å‘ LLM æ¨¡å‹å‘é€è¯„ä¼°æç¤ºæ¨¡æ¿ï¼Œè¯·æ±‚æ¨¡å‹é€‰æ‹©æ›´å¥½çš„æ ·æœ¬ã€‚
    - æå–å“åº”ä¸­çš„é€‰æ‹©ç»“æœ (`choose`)ã€‚

5. **ç¡®å®šè¯„ä¼°ç»“æœ**ï¼š
    - æ ¹æ®æ˜¯å¦äº¤æ¢äº†æ ·æœ¬é¡ºåºï¼Œåˆ¤æ–­æ¨¡å‹é€‰æ‹©çš„ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
    - å¦‚æœäº¤æ¢äº†æ ·æœ¬ä¸”æ¨¡å‹é€‰æ‹©äº† "A"ï¼Œåˆ™è¯„ä¼°æˆåŠŸï¼›å¦åˆ™å¦‚æœæœªäº¤æ¢ä¸”æ¨¡å‹é€‰æ‹©äº† "B"ï¼Œä¹Ÿè¯„ä¼°æˆåŠŸã€‚

6. **å¤„ç†å¼‚å¸¸**ï¼š
    - å¦‚æœè¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œè®°å½•é”™è¯¯æ—¥å¿—å¹¶è¿”å› `False` è¡¨ç¤ºè¯„ä¼°å¤±è´¥ã€‚

##### å…³é”®ä»£ç ç‰‡æ®µ
```python
class QuickEvaluate:
    def __init__(self):
        self.llm = SPO_LLM.get_instance()

    async def prompt_evaluate(self, samples: dict, new_samples: dict) -> bool:
        _, requirement, qa, _ = load.load_meta_data()

        if random.random() < 0.5:
            samples, new_samples = new_samples, samples
            is_swapped = True
        else:
            is_swapped = False

        messages = [
            {
                "role": "user",
                "content": EVALUATE_PROMPT.format(
                    requirement=requirement, sample=samples, new_sample=new_samples, answers=str(qa)
                ),
            }
        ]

        try:
            response = await self.llm.responser(request_type=RequestType.EVALUATE, messages=messages)
            choose = extract_content(response, "choose")
            return choose == "A" if is_swapped else choose == "B"

        except Exception as e:
            logger.error(e)
            return False
```


### æ€»ç»“

`_optimize_prompt` å‡½æ•°é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°äº†æç¤ºçš„ä¼˜åŒ–ï¼š
1. åŠ è½½å·²æœ‰æ•°æ®ã€‚
2. å¤„ç†ç¬¬ä¸€è½®ä¼˜åŒ–ã€‚
3. åˆ›å»ºæœ¬è½®ç›®å½•å¹¶ç”Ÿæˆæ–°æç¤ºã€‚
4. è®°å½•æ—¥å¿—å’Œä¿å­˜æç¤ºã€‚
5. æ‰§è¡Œæ–°æç¤ºå¹¶è¯„ä¼°å…¶æ•ˆæœã€‚
6. è®°å½•ä¼˜åŒ–ç»“æœã€‚

æ¯ä¸ªæ­¥éª¤éƒ½ç´§å¯†ç›¸è¿ï¼Œç¡®ä¿äº†æç¤ºä¼˜åŒ–è¿‡ç¨‹çš„å®Œæ•´æ€§å’Œå¯è¿½æº¯æ€§ã€‚


## ç»“æŸè¯­
### åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†å¦‚ä½•åˆ©ç”¨AIå®ç°æç¤ºè¯ç”Ÿæˆçš„åŸç†ï¼Œå¹¶å¯¹Difyçš„æç¤ºè¯ç”Ÿæˆæºä»£ç è¿›è¡Œäº†è¯¦ç»†åˆ†æã€‚
### åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯¹metaSPOæºä»£ç è¿›è¡Œäº†å‰–æï¼Œæ­ç¤ºäº†å…¶å…³é”®é€»è¾‘å’Œå®ç°æ–¹æ³•ã€‚è¿™äº›åˆ†ææœ‰åŠ©äºæ›´å¥½åœ°ç†è§£åœ¨AIæ¨¡å‹ä¸­ï¼Œå¦‚ä½•æœ‰æ•ˆç”Ÿæˆå¹¶ä¼˜åŒ–æç¤ºè¯ï¼Œä»è€Œæå‡æ¨¡å‹çš„è¡¨ç°å’Œç”¨æˆ·ä½“éªŒã€‚
### é€šè¿‡æœ¬æ¬¡ç ”ç©¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ¸…æ™°åœ°çœ‹åˆ°æç¤ºè¯ç”Ÿæˆçš„æ½œåŠ›ï¼Œå¹¶ä¸ºæœªæ¥åœ¨è¯¥é¢†åŸŸçš„è¿›ä¸€æ­¥æ¢ç´¢æä¾›äº†åšå®çš„åŸºç¡€ã€‚
### å¸Œæœ›æœ¬æ–‡çš„åˆ†æèƒ½å¤Ÿä¸ºæ‚¨åœ¨AIå¼€å‘å’Œåº”ç”¨ä¸­å¸¦æ¥å¯å‘ä¸å¸®åŠ©ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³æ³•ï¼Œæ¬¢è¿éšæ—¶äº¤æµè®¨è®ºã€‚